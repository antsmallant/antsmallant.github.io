---
layout: post
title: "工作笔记：避免资源泄漏"
date: 2025-08-23
last_modified_at: 2025-08-23
categories: [工作]
tags: [工作 总结]
---

* 目录  
{:toc}
<br/>

资源的有效释放始终是个艰难的问题。举个例子，一个房间中等到所有人都不在的时候就释放房间。而当房主退出的时候，要踢出所有人。假设所有人都走这个 exit 逻辑，并且 exit 逻辑里面判断人数为 0 就走释放房间逻辑。这样就很糟了，中间有个环节出错，房间资源就泄漏了。   

怎么做才是安全的呢？标记状态+超时处理。当房主退出的时候，直接就标记房间状态为 releasing，另外加个超时时间，由另外的 tick 逻辑去保证最终会销毁掉这个房间。    

总结起来，就是不要逻辑的耦合调用，而是改为写状态，记录目标，中间任何出错都不要影响最终目标的执行。   

先写这么多，这是一个大话题，可以总结一些基本的原则出来，形成一套统一而安全优雅做法。   