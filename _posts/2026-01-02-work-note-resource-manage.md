---
layout: post
title: "工作笔记：避免资源泄漏"
date: 2026-01-02
last_modified_at: 2026-01-02
categories: [工作]
tags: [工作 总结]
---

* 目录  
{:toc}
<br/>

资源的有效释放始终是个艰难的问题。特别是在具体的业务逻辑中，由于逻辑的多变和复杂，导致出错的可能性大大增加。  

举个例子，游戏服务器，一个房间中等到所有人都不在的时候就销毁房间。而当房主退出的时候，要踢出所有人。假设所有人退出都走同样的 exit 逻辑，并且 exit 逻辑里面判断人数为 0 就销毁房间。这样就很糟了，exit 调用 exit，中间有个环节出错，房间就不释放了。  

怎么做才是安全的呢？标记状态+超时处理。当房主退出的时候，直接就标记房间状态为 releasing，并加上超时时间，由另外的 tick 逻辑去保证最终会销毁这个房间。    

总结起来，就是不要逻辑的耦合调用，而是改为写状态，记录目标，中间任何出错都不要影响最终目标的执行。   

先写这么多，这是一个大话题，可以总结一些基本的原则出来，形成一套统一而安全优雅做法。   