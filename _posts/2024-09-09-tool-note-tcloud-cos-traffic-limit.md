---
layout: post
title: "腾讯云 cos 流量防刷"
date: 2024-09-09
last_modified_at: 2024-09-09
categories: [工具]
---

* 目录  
{:toc}
<br/>

# 概述

博客的图床用的是腾讯云的 cos，我的桶设置为了公有读私有写，因为私有读写太麻烦了，用起来不方便。而公有读私有写又有盗刷问题，我的cos是后付费的，而腾讯云又没法实际消费金额上限，那么当盗刷发生的时候，系统会把我的账户扣费成负数，除非我以后都不用腾讯云了，总需要把欠费补上的。   

于是，为了防止被盗刷流量，做了一些研究。    

方法一：设置防盗链   

这种方式是设置 referer，防不住真正要盗刷流量的。   

所以，这种方法行不通。  

<br/>

方法二：cdn + cos   

通过给 cdn 配置流量阈值，来达到限制。太麻烦了，我的博客几乎没啥流量，犯不着另外配置 cdn。   

所以，这种方法对我没用。  

<br/>

方法三：云函数监测流量，超过阈值自动把cos桶的权限改为私有读写      

这个方法参考自这篇文章 [《使用腾讯云SCF实现COS费用封顶的最佳实践》](https://cloud.tencent.com/developer/article/2258668) [1]，查了一下，作者本人就是腾讯云的员工。   

按照文章的指引，成功的对 cos 桶进行了流量控制，目前设置是 5 分钟内（采样10分钟前的数据）流量超过 30MB 就关闭桶的公有读。   

所以，这种方法对我是有效的。   

---

# 大概做法

简单描述一下做法。   



---

# 参考

[1] wainsun. 使用腾讯云SCF实现COS费用封顶的最佳实践. Available at https://cloud.tencent.com/developer/article/2258668, 2023-04-13.   